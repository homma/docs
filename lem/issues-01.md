## 問題点

1. 先頭に改行が入らない
2. 改行時に出力位置がリセットされない
3. もともと存在していたテキストが表示されたままになるので、出力が混ざる

## 望ましい形

- 読みやすい形で出力されて欲しい
- 出力自体は必要

## 調査方法
- `C-x C-e` をしている場所を調べて動作の仕組みを確認する

## 関連する関数

### self-lisp-eval-last-expression

- https://github.com/cxxxr/lem/blob/master/modes/lisp-mode/lisp-mode.lisp#L386

### self-interactive-eval

- https://github.com/cxxxr/lem/blob/master/modes/lisp-mode/lisp-mode.lisp#L364

### write-string-to-repl

- https://github.com/cxxxr/lem/blob/master/modes/lisp-mode/repl.lisp#L228

`*lisp-repl*` に出力している。

## 出力をしている場所

- time が `*trace-output*` に出力していた
- eval が *error-output* に出力していた

`*trace-output` と `*error-output` がハンドルされれば出力は消える
````lisp
(defun self-interactive-eval (string)
  (let* ((*package* (self-current-package))
         (*trace-output* (make-string-output-stream))
         (*error-output* (make-string-output-stream))
         (*standard-output* (make-string-output-stream))
         (values (multiple-value-list (eval (read-from-string string))))
         (output (get-output-stream-string *standard-output*)))
````

## 原因

### なぜ出力位置がリセットされないのか

- これは謎

## どう修正すべきか

- trace 関数を修正するのは難しそう
  - trace は SBCL 側の実装なので、修正すると影響が大きそう

- `*standard-output*` と同じように、`write-string-to-repl` すれば良い

## Title
[lisp-mode] handle trace and error outputs

## Issue Description

The `self-interactive-eval` function does not handle trace and error outputs generated by `eval` at all and it makes unpleasant outputs as shown below.

The issue is observed in the following environment.

- macOS 10.13.6
- sbcl-bin/1.4.12

### Possible resolution

It may be possible to handle `*trace-output*` and `*error-output*` in the same way as `*standard-output*` which writes to the `*lisp-repl*`.

````diff
diff --git a/modes/lisp-mode/lisp-mode.lisp b/modes/lisp-mode/lisp-mode.lisp
index 3f3756be..687c088a 100644
--- a/modes/lisp-mode/lisp-mode.lisp
+++ b/modes/lisp-mode/lisp-mode.lisp
@@ -363,9 +363,17 @@
 
 (defun self-interactive-eval (string)
   (let* ((*package* (self-current-package))
+         (*trace-output* (make-string-output-stream))
+         (*error-output* (make-string-output-stream))
          (*standard-output* (make-string-output-stream))
          (values (multiple-value-list (eval (read-from-string string))))
+         (trace-output (get-output-stream-string *trace-output*))
+         (error-output (get-output-stream-string *error-output*))
          (output (get-output-stream-string *standard-output*)))
+    (unless (zerop (length error-output))
+      (write-string-to-repl error-output))
+    (unless (zerop (length trace-output))
+      (write-string-to-repl trace-output))
     (unless (zerop (length output))
       (write-string-to-repl output))
     (message "=> ~{~S~^, ~}" values)))
````

### Sample output #1

- trace output is not handled
````
(time (1+ 0))Evaluation took:
                               0.000 seconds of real time
                                                           0.000001 seconds of total run time (0.000001 user, 0.000000 system)
                                                                                                                                100.00% CPU
                                                                                                                                             839 processor cycles
                                                                                                                                                                   0 bytes consed
````

### Sample output #2

- error output is not handled
````
(defun foo () bar); in: defun foo
                                 ;     (BLOCK FOO BAR)
                                                      ; 
                                                        ; caught warning:
                                                                         ;   undefined variable: bar
                                                                                                    ; 
                                                                                                      ; compilation unit finished
                                                                                                                                 ;   Undefined variable:
                                                                                                                                                        ;     bar
                                                                                                                                                                 ;   caught 1 WARNING condition
````

## メモ

- `C-c C-e` で評価をすると別のバッファに出力されるので表示が崩れない
