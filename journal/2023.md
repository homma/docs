## 8.4

### YAML 的なものを parse する
- 行ごとに parse する // newline を見る
- インデント幅を変数に保持し、`INDENT` および `DEDENT` token を挿入する

- List と即値とコメントだけを扱いたいので、厳密には YAML ではない
   - yamlette

## 8.2

### evcxr
名前が覚えにくい  
eval context for rust  

名前を思い出しながら起動するので立ち上げが遅くなる  
alias をつけた方がいいかも  
rusti にしました

shared library を作成してロードするせいか、レスポンスが遅い  
これならインタープリタ方式の方が速くなるかもしれない  
CPU やファイルシステムが十分に速ければ問題ないのかもしれない

## 8.1

### cacao と cocoa どっち?
cacao は一般のアプリで使用されることを意図しているので、使いやすそう  
cocoa は servo で使用されているので、永続的に使用できそう

#### cacao
https://docs.rs/cacao/latest/cacao/  
https://crates.io/crates/cacao  
cocoa crate は servo と密結合しているので cacao create を作ったよとのこと  

https://docs.rs/cacao/latest/cacao/foundation/index.html  
cacao foundation は cocoa の core-foundation-rs の id の扱いに違和感があったからとのこと

#### cocoa
https://github.com/servo/core-foundation-rs  
https://blog1.mammb.com/entry/2023/03/03/182448  

Sample  
https://github.com/servo/core-foundation-rs/blob/master/cocoa/examples/hello_world.rs

#### RustKit
https://github.com/michaelwu/RustKit

### YAML S-exp
悪くないのでは

````
# fuctorial
- fun
- factorial
- - n
- - if
  - - ge
    - n
    - 1
  - 1
  - - multiply
    - n
    - - factorial
      - - minus
        - n
        - 1
````

````
# (list 1 2 "foo")
- list
- 1
- 2
- "foo"
````

````
# (+ 1 2 3 4)
- plus
- 1
- 2
- 3
- 4
````

````
# (lambda (x y) (+ x y))
- lambda
- - x
  - y
- - plus
  - x
  - y
````

#### another form
````
fun:
  name: factorial
  args:
    - n
  body:
    if:
      cond:
        ge:
         - n
         - 1
      true: 1
      false:
        multiply:
          - n
          - factorial:
              - minus:
                  - n
                  - 1
````

````
fun:
  - factorial
  - - n
  - if:
      - ge:
         - n
         - 1
      - 1
      - multiply:
          - n
          - factorial:
              - minus:
                  - n
                  - 1
````

````
fun:
  - factorial
  - [n]
  - if:
      - ge: [n, 1]
      - 1
      - multiply:
          - n
          - factorial:
              - minus: [n, 1]
````

````
# hello world
fun:
  - hello-world
  - []
  - print: 'hello world.'
````

````
# multi-line text
fun:
  - multi-line
  - []
  - print: |
      first line.
      second line.
````

## 7.31

### Swift について
何度か Swift でプログラムを書こうとした後の印象

- Swift 自体は良い言語
- Swift に用意されている API を呼び出そうとすると、抽象度の高いものばかりで、実装したい操作まで辿り着くのが大変
  - フラグを変更したいだけなのに、専用の API がなく、ディクショナリに自分でデータを作成してから API を実行する必要があるなど
- Swift だけでは完結せず、C, ObjC, C++ を呼び出さざるを得なくなる
- 今でも ObjC ベースのドキュメントを参照する必要がある
- Swift のサンプルコードも少ない
- XCode が前提になっている
- REPL は使い勝手が良くない（起動が遅いし、プロンプトの設定もできない）

やりたいことを実装するのが大変で Swift を使うメリットが感じられない

例えば、USB デバイスを操作するプログラムを書くなら、IOKit などを使うよりも libusb を使った方が何倍も簡単  
PDF を編集するプログラムなら PDFKit より Python なんかで市井のライブラリを使った方が楽

### winit
https://komi.dev/post/2021-07-20-enabling-ime-in-alacritty/  
https://github.com/rust-windowing/winit/pull/1979

macOS でも日本語の入力に対応しているみたい

### REPL の実装に関するノート

基本は以下になるみたい
- コードをパースして、宣言、文、式などに分類する
- パースしたコードの種類に合わせてラッパーを追加する
- 変数や関数は専用のデータ構造を用意してストアする
- 変数や関数への参照はそちらを向くように書き換える
- 共有ライブラリとしてコンパイルする
- ロードして実行する
- REPL のプロセスと実行プロセスは分ける（サブプロセスにする）

共有ライブラリを作成できない言語では難しい  

#### Rust
https://github.com/evcxr/evcxr/blob/main/evcxr/HOW_IT_WORKS.md  
https://github.com/evcxr/evcxr/blob/main/COMMON.md#limitations

実装については冒頭に記載した形になっている  
他の Crate からマクロをインポートすることができないという制限がある

#### D
https://github.com/callumenator/dabble/blob/master/readme.md  
https://github.com/dlang-community/drepl/blob/master/src/drepl/engines/dmd.d

https://qiita.com/sobaya007/items/66876036bb318c368f5c  
https://karita.xyz/notes/d-jupyter.html

#### C
https://neugierig.org/software/c-repl/

#### Zig
https://github.com/ziglang/zig/issues/596

実装が難しいポイントが書かれている

#### Crystal
https://github.com/crystal-lang/crystal/issues/681

コンパイラとは別の実装として作成されている

#### Swift
https://www.swift.org/lldb/

デバッガを使用した特殊な実装  
起動が遅いのが難点

#### Go
Go 言語には冒頭に挙げたような実装の REPL は存在しないみたい  

https://github.com/x-motemen/gore

これは過去のコードを全て実行するみたいなので、逐次実行ではない

### "Building and loading dynamic libraries at runtime in Swift"
https://theswiftdev.com/building-and-loading-dynamic-libraries-at-runtime-in-swift/

### SwiftSyntax
https://github.com/apple/swift-syntax

これで REPL 作成できないかな

算術演算くらいなら実装できるかも

### 欲しいもの
このページのような雑記帳（マイクロブログ）

- Markdown で記入できる
- 文字数などの制限がない
- エントリー単位でデータを蓄積
  - title, body, date, tags
- 全てのエントリーを一覧表示できる
- 個別のエントリーを単独で表示できる
- タグで分類できる
- ログインしてデータを作成
- CLI からもデータを push 可能
- git で管理される

GitHub で実現できたら楽なのですが...

Issues を使う方法は abuse っぽい感じがする

https://egghead.io/blog/github-issues-powered-blog

ディレクトリに Markdown を作成したら、良い感じで読み出してほしい

### Python ctypes
https://docs.python.org/ja/3/library/ctypes.html

`CDLL` でライブラリをロードできる

### REPL for D Programming Language

#### drepl
https://github.com/dlang-community/drepl  
https://github.com/dlang-community/drepl/blob/master/src/drepl/interpreter.d  
https://github.com/dlang-community/drepl/blob/master/src/drepl/engines/dmd.d

以下のような操作で REPL を実現している
- 入力を宣言 (Decl)、文 (Stmt)、式 (Expr) に分別
- それぞれを C 言語のライブラリとしてコンパイル
- ライブラリをロード

変数の再定義やコンパイル単位をまたぐ参照をどうしているのかはよく分からず

Swift でも同じようなことができないかな

https://karita.xyz/notes/d-jupyter.html にも情報があった

#### dabble
https://github.com/callumenator/dabble

別の実装  
c-repl を参考にしているとのこと

https://neugierig.org/software/c-repl/

via https://forum.dlang.org/post/xemrxpwusliqsegkqtbx@forum.dlang.org

### OCaml and UTF8
https://rosettacode.org/wiki/String_length#Character_Length_72

UChar モジュールを使用すれば、文字列を UTF8 として操作する処理を実装できる
