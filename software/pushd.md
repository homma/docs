---
title: pushd/popd について
author: homma
status: draft
---

--------------------------------------------------------------------------------

### pushd
- pushd は push だけでなく pop やスタックの rotate、ディレクトリの移動も行う
- pushd は cd を代替するコマンド

### popd
- popd はスタックトップの pop も行えるが、pop は pushd でも実行できる
- popd はスタックのエントリーの削除ができる

### dirs
- pusud, popd だけでなく、スタックを参照する dirs コマンドが存在する
- dirs コマンドはスタックのエントリーの全削除も行う

### スタック
- スタックは 0 番から始まるが、スタックの 0 番は特別なエントリー
- スタックの 1 番がスタックトップ

--------------------------------------------------------------------------------

### Zsh: AUTO_PUSHD

````sh
setopt AUTO_PUSHD
````

`cd` で移動すると自動的に履歴が保存される  
`dirs -v` でディレクトリの履歴を確認  
`cd +n` で履歴内のディレクトリに移動  
`dirs -c` で履歴を全て削除  
`popd +n` で特定の履歴を削除

設定を弄れる環境ならこれで良いかも  
設定を弄れない場合は `pushd` コマンドを使用する

`alias cd=pushd` だと、以下の動作になるので `AUTO_PUSHD` にします  
- `cd` する度にディレクトリのリストが表示される
- オプションなしで `cd` したときにホームディレクトリではなくスタックトップのディレクトリへ移動する

`alias dirs="dirs -v"` をすると `dirs -c` ができなくなる  
代わりに `alias dir="dirs -v"` にしました

### zsh の pushd, popd, dirs
以下のような特徴があり、動作を把握する必要がある

- 単純に push, pop するわけではない
  - pushd が pop する
  - popd が単純削除する
- スタックの 0 と 1 以降の扱いが異なる

`pushd` がディレクトリをスタックに push するコマンドというのは正確ではない
- `pushd` は push だけするコマンドではなく、pop したり rotate したりする
- `pushd` が push するのはコマンドで指定したディレクトリではなくカレントディレクトリ
- `pushd` はスタックの情報を使用してディレクトリを移動するためのコマンド

#### 基本的な使い方
以下のような使い方をすると良さそう

- `pushd .` でカレントディレクトリを記憶する
- `cd` で自由に移動する
- `dirs -v` でエントリーを確認する
- `pushd +n` で元のディレクトリに戻る

以下のような `alias` を切っておくと良いかもしれない

````sh
# store directory
alias strd="pushd ."
# list directory entry
alias lstd="dirs -v"
# change directory
alias chgd="pushd +${1}"
# delete directory
alias deld="popd +1"
````

登録と移動は `pushd`、確認は `dirs`、削除は `popd` と覚えておけば良いのかもしれない

#### スタックの状態
スタック 0 は、常にカレントディレクトリになる  
スタック 1 以降が `pushd` によって格納されたディレクトリ

````
0: 常にカレントディレクトリを指す
1: pushd によって格納されたディレクトリ
````

0 と 1 以降で意味合いが異なるので注意が必要

#### dirs
`dirs -v` で現在のスタックの状況を番号付きで確認できる  

#### pushd
`pushd` は pop するので注意が必要

`pushd` は以下の動作を行う
````
1. スタックのエントリー 1 を pop する
2. pop したディレクトリに移動する
3. 元いたディレクトリをスタックに push する
````

`pushd <DIR>` は以下の動作を行う
````
1. <DIR> に移動する
2. 元いたディレクトリをスタックに push する
````

`pushd .` は以下の動作を行う
````
1. カレンティディレクトリに移動する
2. 元いたディレクトリ（カレントディレクトリ）をスタックに push する
````

`pushd +n` は以下の動作を行う
````
1. スタックの n 番目のエントリーに移動する
2. スタックの n 番目のエントリーが 0 になるようにローテートする
````

`pushd <DIR1> <DIR2>` については未確認  
`pushd -n` についても未確認

#### popd
エントリーを削除するためのコマンドと考えた方が良さそう

`popd`  は以下の動作を行う
````
1. スタックのエントリー 1 を pop する
2. pop したディレクトリに移動する
````

`popd +0` は以下の動作を行う
````
1. スタックのエントリー 1 を pop する
2. pop したディレクトリに移動する
````

`popd +n` は以下の動作を行う
````
1. スタックのエントリー n を削除する
````

### 元々予想していた動作
`pushd` はカレントディレクトリをスタックに push する  
`pushd` 自体は移動を行わず、移動は `cd` を使用する  
スタックトップは `pushd` で push したディレクトリ  
`popd` はスタックトップのディレクトリを pop して移動する

